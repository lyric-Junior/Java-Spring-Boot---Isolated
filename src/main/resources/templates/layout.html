<!DOCTYPE html>
<!-- 
    THYMELEAF: Declaração do namespace para usar atributos thymeleaf
    xmlns:th="http://www.thymeleaf.org" → Permite usar th: atributos
-->
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml" lang="pt-br">
<head>
    <meta charset="UTF-8">

    <!-- 
        th:title: Substitui conteúdo dinamicamente
        ${titulo} vem do Controller via Model
        Se não houver título, usa "Sistema de Estoque" (padrão)
    -->
    <title th:text="${titulo} ?: 'Sistema de Estoque'"></title>

    <!-- Bootstrap 5 para estilização -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- 
        th:fragment="head": Define um fragmento que pode ser reusado
        Outros templates podem incluir este fragmento
    -->
    <th:block th:fragment="head">
        <style>
            /* Estilos personalizados */
            .produto-card {
                transition: transform 0.2s;
                border: 1px solid #dee2e6;
                border-radius: 8px;
            }
            .produto-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
            .estoque-baixo {
                color: #dc3545;
                font-weight: bold;
            }
            .estoque-ok {
                color: #198754;
            }
        </style>
    </th:block>
</head>
<body>
<!-- 
    NAVBAR: Menu de navegação fixo no topo
    th:classappend: Adiciona classe condicionalmente
-->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <!-- 
            th:href="@{/}": Gera URL relativa à aplicação
            @{} é o mecanismo de link do Thymeleaf
            Se sua app estiver em /contexto, gera /contexto/
        -->
        <a class="navbar-brand" th:href="@{/}">
            <i class="bi bi-box-seam"></i> Sistema de Estoque
        </a>

        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
                <!-- 
                    th:classappend: Adiciona 'active' se a URL atual for /produtos
                    #request é objeto implícito do Thymeleaf com info da requisição
                -->
                <li class="nav-item" th:classappend="${#request.requestURI == '/produtos'} ? 'active'">
                    <a class="nav-link" th:href="@{/produtos}">
                        <i class="bi bi-list-ul"></i> Produtos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/produtos/novo}">
                        <i class="bi bi-plus-circle"></i> Novo Produto
                    </a>
                </li>
            </ul>

            <!-- Área de busca -->
            <form class="d-flex" th:action="@{/produtos/buscar}" method="get">
                <input class="form-control me-2" type="search"
                       name="nome" placeholder="Buscar produto..."
                       th:value="${termoBusca}">
                <button class="btn btn-outline-light" type="submit">
                    <i class="bi bi-search"></i>
                </button>
            </form>
        </div>
    </div>
</nav>

<!-- 
    CONTEÚDO PRINCIPAL: Onde cada página injeta seu conteúdo
    layout:fragment="conteudo": Define um "slot" para conteúdo dinâmico
-->
<main class="container my-4">
    <!-- Mensagens de sucesso/erro -->
    <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show">
        <span th:text="${mensagemSucesso}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- 
        Aqui vai o conteúdo específico de cada página
        Outros templates preenchem este bloco
    -->
    <div layout:fragment="conteudo">
        <!-- Conteúdo será substituído -->
    </div>
</main>

<!-- RODAPÉ -->
<footer class="bg-light text-center py-3 mt-5 border-top">
    <div class="container">
        <p class="mb-0 text-muted">
            Sistema de Estoque v1.0 &copy; <span th:text="${#dates.year(#dates.createNow())}">2024</span>
            | Total de produtos: <span th:text="${#numbers.formatInteger(totalProdutos, 0)}">0</span>
            | Valor total em estoque: R$ <span th:text="${#numbers.formatDecimal(valorTotalEstoque, 0, 2)}">0,00</span>
        </p>
    </div>
</footer>

<!-- Scripts JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Ícones do Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

<!-- 
    Scripts específicos por página podem ser injetados aqui
    layout:fragment="scripts" define um slot para scripts
-->
<th:block layout:fragment="scripts">
    <!-- Scripts padrão (vazio por padrão) -->
</th:block>
</body>
</html>